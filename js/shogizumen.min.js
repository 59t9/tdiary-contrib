/* 
 shogizumen.js ver.20170713 
 (c) maasa. | http://www.geocities.jp/ookami_maasa/shogizumen/
*/
(function(a){if(typeof(SSZumen)=="undefined"){SSZumen=a;window.addEventListener("load",SSZumen,false)}})(function(){function u(){var v=document.createElement("div");v.innerHTML="<svg/>";return v.firstChild&&v.firstChild.viewBox!=undefined}if(!u()){return}var k=".shogizumen";var p="pre";var j=0;var a=0;var c=0;var l=function(){var w=document.querySelectorAll(k);for(var x=0;x<w.length;x++){var v=w[x];var C;if(v.tagName.toLowerCase()!=p){C=v.querySelector(p)}else{C=v;v=v.parentNode}var B=m(C.innerHTML);if(B!=false){var y=C.offsetWidth;var A=C.offsetHeight;C.style.display="none";var z=v.insertBefore(b(y,A,B),C);z.appendChild(C)}}};var r="123456789";var h="１２３４５６７８９";var s="一二三四五六七八九";var t="玉飛角金銀桂香歩玉龍馬金全圭杏と";var n=function(w){var v=new RegExp("["+h+s+"]","g");w=w.replace(v,function(x){return r.charAt((h+s).indexOf(x)%9)});w=w.replace("０","0");w=w.replace(/十([1-9])/,"1$1");w=w.replace("十","10");w=w.replace(/(.)(1?[0-9])/g,function(y,x,B){for(var z=0,A="";z<B;z++){A+=x}return A});return w};var o=function(v){v=v.replace("王","玉");v=v.replace("竜","龍");v=v.replace("仝","杏");v=v.replace("个","と");return v};var m=function(I){var w,B,G,E,K,D,A,C;var F=new Array(98);for(var A=0;A<95;A++){F[A]=0}F[95]="先手";F[96]="後手";F[97]=-1;var v="";var z="";var J=/^([先下後上]手の)?持駒：([^\n]*)/mg;while((w=J.exec(I))!=null){if(/[後上]/.test(w[1])){z=w[2]}else{v=w[2]}}J=/^([先下後上]手)：(.*)\n/mg;while((w=J.exec(I))!=null){w[2].replace(/^\s+/,"");w[2].replace(/(\s|　).*$/,"");if(/[後上]/.test(w[1])){F[96]=w[2]}else{F[95]=w[2]}}E=1;J=/^\|([^\n]*)/mg;while((w=J.exec(I))!=null){w[1]=o(w[1]);G=9;C=new RegExp("([\\+\\-vV\\^\\s])(.)","g");while((B=C.exec(w[1]))!=null){K=("vV-".indexOf(B[1])>-1)?2:0;if((D=t.indexOf(B[2]))>-1){if(D>7){D-=8;K=K|1}F[E*9-G]=K*8+D+1}if(--G<1){break}}if(++E>9){break}}if(E==1){return false}v=n(v);for(A=0;A<v.length;A++){if((D=t.indexOf(v.charAt(A)))>0){F[81+D-1]+=1}}z=n(z);for(A=0;A<z.length;A++){if((D=t.indexOf(z.charAt(A)))>0){F[88+D-1]+=1}}J=/^手数＝\d+\s+[▲△▽]?(.)(.)(.*)まで/mg;if((w=J.exec(I))!=null){var H=-100;if((D=0+w[1])>0){H=8-D}else{if((D=h.indexOf(w[1]))>0){H=8-D}}if((D=0+w[2])>0){H+=D*9}else{if((D=h.indexOf(w[2]))>0){H+=D*9}else{if((D=s.indexOf(w[2]))>0){H+=D*9}}}F[97]=H}return F};var d="http://www.w3.org/2000/svg";var e="inherit";var f=1;var q="currentColor";var i=function(x,A){var z="";for(var y=1;y<8;y++){var w=A[81+x*7+y-1];if(w>0){z+=t.charAt(y);if(w>1){if(w>10){z+="十";w-=10}z+=s.charAt(w-1)}}}if(z==""){return"なし"}return z};var g=function(D,A,z,C){var y=A.createElementNS(d,"g");var E=(D==0)?"☗"+C[95]+"　":"☖"+C[96]+"　";E+=i(D,C);for(var x=0;x<E.length-f;x++){var F=A.createElementNS(d,"text");F.textContent=E.charAt(E.length-x-1);F.setAttribute("font-family",e);F.setAttribute("font-size",z*9/14);F.setAttribute("fill",q);F.setAttribute("text-anchor","middle");F.setAttribute("x",0);F.setAttribute("y",-x*z*9/14);y.appendChild(F)}if(f){var F=A.createElementNS(d,"polygon");var B=-E.length*z*9/14;F.setAttribute("points","0,"+B+" "+z*0.23+","+(B+z*0.1)+" "+z*0.3+","+(B+z*0.6)+" "+z*-0.3+","+(B+z*0.6)+" "+z*-0.23+","+(B+z*0.1));if(D!=0){F.setAttribute("fill","none")}else{F.setAttribute("fill",q)}F.setAttribute("stroke",q);F.setAttribute("stroke-width",z/25);y.appendChild(F)}var w=(E.length>14)?14/E.length:1;if(D==0){y.setAttribute("transform","translate("+(z*11.35)+","+(z*9.7)+") scale(1,"+w+")")}else{y.setAttribute("transform","translate("+(z*0.65)+","+(z*0.8)+") scale(-1,"+(-w)+")")}return y};var b=function(I,P,T){var R=document;var M=R.createElementNS(d,"svg");var K=T[97];var S=j;if(S==0){S=(I/12<P/10)?Math.floor(I/12):Math.floor(P/10);if(S<a){S=a}if(c&&S>c){S=c}}console.log(I,P,S);M.setAttribute("width",S*12);M.setAttribute("height",S*10);M.style.verticalAlign="bottom";var J=Math.floor(S*1.25);var H=Math.floor(S*0.75);var N;if(window.devicePixelRatio&&window.devicePixelRatio>=2){N=1/2}else{N=1}var Q=R.createElementNS(d,"g");var v=R.createElementNS(d,"rect");v.setAttribute("x",J);v.setAttribute("y",H);v.setAttribute("width",S*9+1);v.setAttribute("height",S*9+1);v.setAttribute("stroke-width",2);v.setAttribute("stroke",q);v.setAttribute("fill","none");Q.appendChild(v);for(var O=0;O<9;O++){if(O){var V=R.createElementNS(d,"line");var X=R.createElementNS(d,"line");V.setAttribute("x1",O*S+J+N/2);V.setAttribute("x2",O*S+J+N/2);V.setAttribute("y1",H+N/2);V.setAttribute("y2",H+S*9+N/2);V.setAttribute("stroke-width",N);V.setAttribute("stroke",q);X.setAttribute("y1",O*S+H+N/2);X.setAttribute("y2",O*S+H+N/2);X.setAttribute("x1",J+N/2);X.setAttribute("x2",J+S*9+N/2);X.setAttribute("stroke-width",N);X.setAttribute("stroke",q);Q.appendChild(V);Q.appendChild(X)}var U=R.createElementNS(d,"text");var W=R.createElementNS(d,"text");U.setAttribute("x",O*S+J+S/2);U.setAttribute("y",H-S/6);U.setAttribute("font-family",e);U.textContent=h.charAt(8-O);U.setAttribute("font-size",S*0.4);U.setAttribute("fill",q);U.setAttribute("text-anchor","middle");Q.appendChild(U);W.setAttribute("x",J+S*9+S*0.35);W.setAttribute("y",O*S+H+S*0.6);W.textContent=s.charAt(O);W.setAttribute("font-size",S*0.4);W.setAttribute("font-family",e);W.setAttribute("fill",q);W.setAttribute("text-anchor","middle");Q.appendChild(W)}M.appendChild(Q);for(var O=0;O<81;O++){if(T[O]>0){var G=(O%9)*S+J+S/2+N/2;var F=Math.floor(O/9)*S+H+S/2+N/2;var A=R.createElementNS(d,"g");var L=t.charAt((T[O]-1)&15);var z=R.createElementNS(d,"text");z.setAttribute("fill",q);if("全圭杏".indexOf(L)!=-1){var z=R.createElementNS(d,"text");z.setAttribute("font-size",S*0.82);L=t.charAt((T[O]-1)&7);if(O==K){z.setAttribute("class","szLastMove")}else{z.setAttribute("font-family",e)}z.setAttribute("text-anchor","middle");z.setAttribute("dy",-S*0.09);z.textContent="成";A.appendChild(z);z=R.createElementNS(d,"text");z.setAttribute("dy",S*0.32+S*0.41);if(T[O]>16){A.setAttribute("transform","translate("+(G)+","+(F)+") scale(-1,-0.5)")}else{A.setAttribute("transform","translate("+(G)+","+(F)+") scale(1,0.5)")}}else{z.setAttribute("dy",S*0.32);if(T[O]>16){A.setAttribute("transform","translate("+(G)+","+(F)+") scale(-1,-1)")}else{A.setAttribute("transform","translate("+(G)+","+(F)+")")}}z.setAttribute("font-size",S*0.82);if(O==K){z.setAttribute("class","szLastMove")}else{z.setAttribute("font-family",e)}z.setAttribute("text-anchor","middle");z.textContent=L;A.appendChild(z);M.appendChild(A)}}var C=g(0,R,S,T);M.appendChild(C);var B=g(1,R,S,T);M.appendChild(B);var E=document.createElement("div");E.style.position="relative";E.style.width=S*12+"px";E.style.height=S*10+"px";E.style.overflow="auto";(function(w){w.onmouseover=function(x){this.childNodes[1].style.display="block"};w.onmouseout=function(x){this.childNodes[1].style.display="none"}})(E);var D=document.createElement("div");D.style.position="absolute";D.style.right=0+"px";D.style.top=0+"px";D.style.zIndex="9999";D.style.width="30px";D.style.height="16px";D.style.borderRadius="4px";D.style.backgroundColor="#CCC";D.style.display="none";D.style.fontSize="14px";D.style.lineHeight="1";D.style.color="black";D.style.cursor="pointer";D.style.baseline="middle";D.title="表示切替（局面図⇔kif形式）";D.style.textAlign="center";D.innerHTML="⇔";D.onclick=function(){var w=this.parentNode;if(this.previousSibling.style.display=="none"){this.previousSibling.style.display="";this.nextSibling.style.display="none"}else{this.previousSibling.style.display="none";this.nextSibling.style.display=""}};E.appendChild(M);E.appendChild(D);return E};l()});